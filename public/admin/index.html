<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>Admin · local-hosted-wordle</title>
    <script>
      (() => {
        const STORAGE_KEY = "themePreference";
        const VALID = new Set(["system", "light", "dark"]);
        try {
          const stored = String(localStorage.getItem(STORAGE_KEY) || "").trim();
          const preference = VALID.has(stored) ? stored : "system";
          const prefersLight =
            typeof window.matchMedia === "function"
            && window.matchMedia("(prefers-color-scheme: light)").matches;
          const resolved = preference === "system" ? (prefersLight ? "light" : "dark") : preference;
          document.documentElement.classList.remove("theme-light", "theme-dark");
          document.documentElement.classList.add(`theme-${resolved}`);
        } catch (_err) {
          document.documentElement.classList.remove("theme-light", "theme-dark");
          document.documentElement.classList.add("theme-dark");
        }
      })();
    </script>
    <link rel="stylesheet" href="/styles.css" />
    <link rel="stylesheet" href="/admin/admin.css" />
  </head>
  <body>
    <a class="skip-link" href="#main">Skip to main content</a>
    <header class="topbar">
      <div>
        <h1>local-hosted-wordle</h1>
        <p id="subtitle">Admin console for provider workflows.</p>
      </div>
      <div class="top-actions">
        <a class="admin-link" href="/">Create</a>
        <a class="admin-link" href="/daily">Daily Word</a>
      </div>
    </header>

    <main id="main" class="layout">
      <section class="panel admin-shell">
        <section id="unlockPanel" class="admin-unlock" aria-live="polite">
          <h2>Admin Console</h2>
          <p class="note">
            Enter your admin key to unlock provider tools. The key is session-scoped and never saved
            in browser storage.
          </p>
          <form id="unlockForm" class="create-form" autocomplete="off">
            <label>
              Admin key
              <input id="adminKeyInput" name="adminKey" type="password" autocomplete="off" />
            </label>
            <button type="submit">Unlock</button>
          </form>
          <div id="unlockStatus" class="message" role="status" aria-live="polite"></div>
        </section>

        <section id="shellPanel" class="admin-workspace hidden" aria-live="polite">
          <div class="admin-shell-head">
            <div>
              <h2>Provider Workspace</h2>
              <p class="note">Session unlocked for this tab only.</p>
            </div>
            <div class="admin-shell-actions">
              <button id="refreshProvidersBtn" type="button" class="ghost">Refresh status</button>
              <button id="lockSessionBtn" type="button" class="ghost">Lock session</button>
            </div>
          </div>

          <nav class="admin-tabs" aria-label="Admin sections" role="tablist">
            <button
              id="admin-tab-providers"
              type="button"
              class="ghost admin-tab"
              data-tab="providers"
              role="tab"
              aria-controls="admin-panel-providers"
              aria-selected="true"
              tabindex="0"
            >
              Providers
            </button>
            <button
              id="admin-tab-imports"
              type="button"
              class="ghost admin-tab"
              data-tab="imports"
              role="tab"
              aria-controls="admin-panel-imports"
              aria-selected="false"
              tabindex="-1"
            >
              Import Queue
            </button>
            <button
              id="admin-tab-runtime"
              type="button"
              class="ghost admin-tab"
              data-tab="runtime"
              role="tab"
              aria-controls="admin-panel-runtime"
              aria-selected="false"
              tabindex="-1"
            >
              Runtime Notes
            </button>
          </nav>

          <section
            id="admin-panel-providers"
            class="admin-slot"
            data-panel="providers"
            role="tabpanel"
            aria-labelledby="admin-tab-providers"
            tabindex="0"
          >
            <h3>Provider Status</h3>
            <p class="note">Readiness snapshot for supported LibreOffice English variants.</p>
            <div class="admin-table-wrap">
              <table class="leaderboard-table" aria-label="Provider status table">
                <thead>
                  <tr>
                    <th>Variant</th>
                    <th>Label</th>
                    <th>Status</th>
                    <th>Active commit</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody id="providersBody"></tbody>
              </table>
            </div>
          </section>

          <section
            id="admin-panel-imports"
            class="admin-slot hidden"
            data-panel="imports"
            role="tabpanel"
            aria-labelledby="admin-tab-imports"
            tabindex="0"
            hidden
          >
            <h3>Provider Import</h3>
            <p class="note">
              Import pulls `.dic` and `.aff` from LibreOffice at a pinned commit, verifies checksums,
              and builds provider artifacts.
            </p>
            <form id="importForm" class="create-form" autocomplete="off">
              <label for="importSourceType">Source</label>
              <select id="importSourceType" name="sourceType">
                <option value="remote-fetch">Remote fetch (default)</option>
                <option value="manual-upload">Manual upload (.dic + .aff)</option>
              </select>

              <label for="importVariant">Variant</label>
              <select id="importVariant" name="variant">
                <option value="en-GB">English (UK)</option>
                <option value="en-US">English (US)</option>
                <option value="en-CA">English (Canada)</option>
                <option value="en-AU">English (Australia)</option>
                <option value="en-ZA">English (South Africa)</option>
              </select>

              <label for="importCommit">Commit (required for remote, optional for manual)</label>
              <input
                id="importCommit"
                name="commit"
                type="text"
                inputmode="text"
                spellcheck="false"
                autocomplete="off"
                placeholder="0123456789abcdef0123456789abcdef01234567"
                maxlength="40"
              />

              <div id="importRemoteFields" class="admin-import-section">
                <label for="importChecksumDic">Dictionary checksum (SHA-256)</label>
                <input
                  id="importChecksumDic"
                  name="checksumDic"
                  type="text"
                  inputmode="text"
                  spellcheck="false"
                  autocomplete="off"
                  placeholder="64-char lowercase sha256"
                  maxlength="64"
                />

                <label for="importChecksumAff">Affix checksum (SHA-256)</label>
                <input
                  id="importChecksumAff"
                  name="checksumAff"
                  type="text"
                  inputmode="text"
                  spellcheck="false"
                  autocomplete="off"
                  placeholder="64-char lowercase sha256"
                  maxlength="64"
                />
              </div>

              <div id="importManualFields" class="admin-import-section hidden">
                <label for="importDicFile">Dictionary file (.dic)</label>
                <input id="importDicFile" name="dicFile" type="file" accept=".dic,text/plain" />

                <label for="importAffFile">Affix file (.aff)</label>
                <input id="importAffFile" name="affFile" type="file" accept=".aff,text/plain" />

                <p class="note">
                  Checksums are generated in-browser from selected files before upload.
                </p>
              </div>

              <label for="importFilterMode">Family filter mode</label>
              <select id="importFilterMode" name="filterMode">
                <option value="denylist-only">Denylist only (default)</option>
                <option value="allowlist-required">Allowlist required</option>
              </select>

              <label class="admin-checkbox">
                <input id="importAsyncMode" name="asyncMode" type="checkbox" checked />
                Queue in background (recommended)
              </label>

              <button id="importSubmitBtn" type="submit">Import provider bundle</button>
            </form>
            <div id="importStatus" class="message" role="status" aria-live="polite"></div>
            <div class="admin-shell-head">
              <h4>Import Queue</h4>
              <button id="refreshJobsBtn" type="button" class="ghost">Refresh queue</button>
            </div>
            <div id="jobsStatus" class="message" role="status" aria-live="polite"></div>
            <div class="admin-table-wrap">
              <table class="leaderboard-table" aria-label="Import queue table">
                <thead>
                  <tr>
                    <th>Job</th>
                    <th>Status</th>
                    <th>Variant</th>
                    <th>Source</th>
                    <th>Commit</th>
                    <th>Updated</th>
                    <th>Error</th>
                  </tr>
                </thead>
                <tbody id="jobsBody"></tbody>
              </table>
            </div>
          </section>

          <section
            id="admin-panel-runtime"
            class="admin-slot hidden"
            data-panel="runtime"
            role="tabpanel"
            aria-labelledby="admin-tab-runtime"
            tabindex="0"
            hidden
          >
            <h3>Runtime Settings</h3>
            <p class="note">
              This section only edits runtime-safe settings. Security and infrastructure values remain
              environment-controlled and read-only here.
            </p>
            <form id="runtimeForm" class="create-form" autocomplete="off">
              <label for="runtimeDefinitionsMode">Definitions mode</label>
              <select id="runtimeDefinitionsMode" name="definitionsMode">
                <option value="memory">memory</option>
                <option value="lazy">lazy</option>
                <option value="indexed">indexed</option>
              </select>

              <label for="runtimeDefinitionCacheSize">Definition cache size</label>
              <input id="runtimeDefinitionCacheSize" name="definitionCacheSize" type="number" min="1" max="4096" />

              <label for="runtimeDefinitionCacheTtlMs">Definition cache TTL (ms)</label>
              <input id="runtimeDefinitionCacheTtlMs" name="definitionCacheTtlMs" type="number" min="1000" max="86400000" />

              <label for="runtimeDefinitionShardCacheSize">Definition shard cache size</label>
              <input id="runtimeDefinitionShardCacheSize" name="definitionShardCacheSize" type="number" min="1" max="26" />

              <label for="runtimeManualMaxBytes">Manual upload max bytes</label>
              <input id="runtimeManualMaxBytes" name="providerManualMaxFileBytes" type="number" min="1048576" max="33554432" />

              <label class="admin-checkbox">
                <input id="runtimePerfLogging" name="perfLogging" type="checkbox" />
                Enable perf logging
              </label>

              <div class="admin-inline-actions">
                <button id="saveRuntimeBtn" type="submit">Save runtime overrides</button>
                <button id="resetRuntimeBtn" type="button" class="ghost">Reset overrides</button>
              </div>
            </form>
            <div id="runtimeStatus" class="message" role="status" aria-live="polite"></div>
            <div class="admin-table-wrap">
              <table class="leaderboard-table" aria-label="Runtime settings source table">
                <thead>
                  <tr>
                    <th>Setting</th>
                    <th>Effective value</th>
                    <th>Source</th>
                  </tr>
                </thead>
                <tbody id="runtimeSourcesBody"></tbody>
              </table>
            </div>
          </section>

          <div id="workspaceStatus" class="message" role="status" aria-live="polite"></div>
        </section>
      </section>
    </main>

    <footer class="footer">
      <span>Admin shell · provider workflow host</span>
      <span id="adminUpdated">Session locked</span>
    </footer>

    <script src="/admin/app.js"></script>
  </body>
</html>
