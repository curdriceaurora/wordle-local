name: Copilot Review Trigger

on:
  workflow_dispatch:
    inputs:
      pr_number:
        description: "PR number to request Copilot review for"
        required: true
        type: number
      head_sha:
        description: "Optional head SHA for audit note"
        required: false
        type: string

permissions:
  contents: read
  pull-requests: write

jobs:
  trigger-copilot-review:
    runs-on: ubuntu-latest
    steps:
      - name: Trigger Copilot Review
        uses: actions/github-script@v7
        with:
          script: |
            const prNumber = Number(core.getInput("pr_number"));
            if (!Number.isInteger(prNumber) || prNumber <= 0) {
              core.setFailed("Invalid pr_number input.");
              return;
            }
            const headSha = core.getInput("head_sha");
            await github.rest.issues.createComment({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
              body: headSha
                ? `/copilot review\n\nManual fallback trigger for head SHA: ${headSha}`
                : "/copilot review\n\nManual fallback trigger"
            });
